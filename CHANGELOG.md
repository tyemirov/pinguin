# Changelog

## Unreleased
- Cached early mpr-ui auth events in `tauth-helper` and seed the session bridge from the cached state to avoid missed auth transitions when the UI loads before the app bootstrap (PG-332 follow-up).
- Fixed auth bootstrap loops by waiting on tauth.js/mpr-ui readiness, removing fallback redirects, and broadening the TAuth CORS allowlist defaults for UI + GIS origins (PG-332).
- Added a declarative `MPRUI.init` configuration bridge so runtime TAuth settings are applied as mpr-ui DSL attributes (PG-331).
- Enforced the `/api/me` session endpoint in the tauth.js bootstrap and validated required helper globals before mpr-ui loads (PG-330).
- Migrated TAuth config to `server.tauth`, removed Pinguin-side access allowlists and tenant admins, defaulted the UI to global view, and aligned the UI/auth tests with `tauth.js` + mpr-ui DSL (PG-329).
- Simplified the TAuth client integration to load `tauth.js` before `mpr-ui` and rely on declarative auth events for UI state (PG-328).
- Aligned mprlab-gateway production orchestration with `pinguin-api.mprlab.com` routing, GitHub Pages UI hosting, and updated CORS/env templates (PG-325).
- Added GitHub Pages deployment for the `/web` bundle with `pinguin.mprlab.com` CNAME and production API/runtime defaults for `pinguin-api.mprlab.com` (PG-324).
- Swapped SQLite to a pure-Go GORM driver so CGO-disabled builds can open SQLite databases (PG-317).
- Reworked tenant and notification GORM queries to use struct/clause builders so SQL is fully generated by GORM (PG-316).
- Made tenant bootstrap domains authoritative by resetting domain mappings and validating duplicates, plus stabilized the Playwright dev server logging for CI (PG-315).
- Switched docker-compose to mount `/web` via the named `pinguin-web` volume bound to `./web` (PS-402).
- Declared `/web` as a Docker volume for the UI bundle and documented the mount expectations (PS-401).
- Moved notification request validation into model constructors and edge handlers, leaving service logic edge-validated (PG-204).
- Optimized retry worker to query pending notifications across active tenants in a single join (PG-203).
- Added a gRPC tenant-resolution interceptor and removed per-handler tenant lookups (PG-202).
- Added the `--disable-web-interface` flag (and matching `DISABLE_WEB_INTERFACE` env var) so operators can run gRPC-only deployments without configuring TAuth/Google web settings (PG-103).
- Documented the multitenancy technical plan (`docs/multitenancy-plan.md`) covering schema, config, auth, and rollout steps for serving multiple domains from one deployment (PG-104).
- Added a regression test that asserts the `third_party` directory stays absent so we continue relying solely on upstream modules for TAuth and google protos (PG-405).
- Relocated `pinguin.proto` to `pkg/proto/pinguin.proto` so consumer-facing definitions live under the exported packages and documented the new path (PG-406).
- Moved the Cobra CLI into `cmd/client`, removed the extra module/go.work entry, and updated build/docs/tests to reference the unified binary (PG-407).
- Removed the Go workspace files (`go.work`/`go.work.sum`) now that the repository relies solely on the root module (PG-408).
- Relocated integration tests to `tests/integration`, renamed the package to `integrationtest`, and updated build tooling accordingly (PG-404).
- Removed `tests/clientcli`; `cmd/client` is the single CLI for manual usage and automated test harnesses (PG-321).
- Removed the `third_party` directory and rely entirely on module-managed dependencies, simplifying Go workspace setup and proto regeneration (PG-402).
- Gated the docker-build GitHub Actions workflow so it only runs after the Go Tests workflow completes successfully, while preserving manual dispatch for emergencies (PG-401).
- Added `dev` and `docker` docker-compose profiles plus a regression test and README guidance so operators can choose between local builds and GHCR-hosted images (PG-400).
- Documented that the Gin HTTP stack no longer serves `/web` and relies on ghttp for the static bundle, keeping the Go server focused on `/api`/`/runtime-config` (BF-306).
- Disabled Playwright’s per-test parallelism so the shared mock dev server state is not mutated concurrently, stabilizing dashboard smoke tests (BF-305).
- Hardened HTTP CORS defaults by disabling credentialed responses whenever `HTTP_ALLOWED_ORIGINS` is empty, preventing cross-site requests from reusing TAuth cookies (BF-304).
- Added a “Docker quickstart” section to README so operators can boot the full orchestration (Pinguin + TAuth + ghttp) with timed commands on the documented ports (IM-200).
- Corrected docker-compose so the ghttp static host binds to `http://localhost:4173` (matching docs/CORS defaults) and updated the TAuth sample `.env`/README instructions accordingly (BF-303).
- Stabilized the scheduled email integration test by waiting for the persisted `sent` status so CI no longer flakes on BF-302.
- Fixed the sample `HTTP_ALLOWED_ORIGINS` value and README docker-compose instructions so compose users open the UI on `http://localhost:4173` and the HTTP API accepts requests from that origin (BF-301).
- Added GoDoc coverage for all client-facing packages (client, attachments, grpcapi, grpcutil, logging) so integrators can rely on `go doc` to understand how to embed the SDK.
- Added a scheduling integration test backed by injectable senders to ensure emails queued with future timestamps are dispatched only after the background worker releases them.
- Extracted the scheduling/retry worker into `github.com/tyemirov/utils/scheduler`, wired the server through a repository/dispatcher bridge, and added unit tests so other binaries can reuse the persistence-agnostic scheduler.
- Removed the `generate-secret` CLI command and `pkg/secret` helper in favor of documenting `openssl rand -base64 32` for token generation.
- Split the CLI and client-test utilities into standalone Go modules so `go run ./...` targets only the server binary.
- Documented all required environment variables in README/.env so the server starts without configuration surprises.
- Segregated server-only config, db, model, and service code under `internal/` while keeping shared clients in `pkg/`.
- Added a Cobra/Viper-based CLI for submitting immediate or scheduled notifications to the Pinguin gRPC service.
- Disabled SMS delivery when Twilio credentials are absent and emit a startup warning to document the configuration gap.
- Renamed the project to Pinguin, including module path, build targets, and user-facing documentation.
- Added comprehensive unit and integration tests across configuration, persistence, and gRPC layers.
- Added GitHub Actions workflow to enforce gofmt, go vet, and go test on pushes and pull requests.
- Added multi-stage Dockerfile and automated GHCR build workflow for the Pinguin gRPC server.
- Added optional `scheduled_time` to the gRPC Notification API and persisted model to support delayed dispatch.
- Updated retry worker to respect scheduled timestamps before attempting delivery.
- Introduced regression tests ensuring scheduled notifications remain queued until due.
- Migrated email delivery configuration to provider-agnostic SMTP naming, eliminating legacy third-party terminology from code and docs.
- Documented the SMTP delivery pipeline and added a unit test verifying the service wires the SMTP sender with configured credentials.
